#!/usr/bin/perl
use strict;
use warnings;

my $dest = '/home/user/MyDocs/backup-sms';

sub run(@){
  print "@_\n";
  system @_;
}

run "mkdir -p $dest";
my $name = `date +%Y_%m_%d-%s`;
chomp $name;

my $cmd = ''
  . " smsbackuprestore export $dest/$name.sms"
  . " 2>&1"
  . " | grep -v \"Not cleaning up obsolete resources for nao:hasTag\"";

run "su user -c 'source /etc/profile; $cmd'";

run "chown", "user.users", "-R", $dest;
